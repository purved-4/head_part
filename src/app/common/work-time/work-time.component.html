<div class="relative inline-block text-left">
  <!-- ===== MAIN BUTTON (compact) ===== -->
  <button
    (click)="toggleDropdown()"
    class="group relative flex items-center gap-2 text-white rounded-xl shadow-[var(--shadow-sm)] transition-all duration-300 hover:shadow-[var(--shadow-md)] hover:scale-105 font-semibold overflow-hidden border border-[var(--color-border)]/50 backdrop-blur-sm bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-primary-dark)]"
  >
    <!-- Shine overlay -->
    <div
      class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"
    ></div>

    <div class="relative flex items-center gap-2">
      <span
        class="font-mono text-sm font-bold px-2.5 py-1.5 rounded-lg bg-[var(--color-surface)]/95 text-[var(--color-font)] shadow-inner border border-[var(--color-border)]"
      >
        {{ workBadgeTime }}
      </span>

      <!-- Logout pending badge – only for USER role -->
      <span
        *ngIf="logoutPendingEvent && isUserRole"
        class="font-mono text-sm font-bold px-2.5 py-1.5 rounded-lg bg-gradient-to-r from-[var(--color-danger)] to-[var(--color-danger)]/80 text-white shadow-md animate-pulse border border-[var(--color-danger)]/30 backdrop-blur-sm"
      >
        {{ pendingRemaining }}
      </span>
    </div>
  </button>

  <!-- ===== DROPDOWN PANEL (compact width & padding) ===== -->
  <div
    *ngIf="showDropdown"
    class="absolute right-0 mt-3 w-[360px] bg-[var(--color-surface)] backdrop-blur-xl border border-[var(--color-border)] rounded-2xl shadow-[var(--shadow-lg)] z-50 overflow-hidden"
  >
    <!-- ===== HEADER (compact) ===== -->
    <div
      class="bg-gradient-to-br from-[var(--color-primary)] via-[var(--color-primary)] to-[var(--color-primary-dark)] px-4 py-3 relative overflow-hidden"
    >
      <!-- Grid overlay (softer) -->
      <div
        class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSAwIDEwIEwgNDAgMTAgTSAxMCAwIEwgMTAgNDAgTSAwIDIwIEwgNDAgMjAgTSAyMCAwIEwgMjAgNDAgTSAwIDMwIEwgNDAgMzAgTSAzMCAwIEwgMzAgNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMC41IiBvcGFjaXR5PSIwLjIiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-10"
      ></div>
      <!-- Shimmer (slower) -->
      <div
        class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse"
      ></div>

      <div class="relative flex justify-between items-center">
        <div>
          <h3
            class="text-lg font-bold text-white flex items-center gap-1.5 drop-shadow-sm"
          >
            <span class="material-symbols-outlined text-xl">timer</span>
            Work Tracker
          </h3>
          <p class="text-white/80 text-xs font-medium mt-0.5">
            Track productivity
          </p>
        </div>
        <button
          (click)="toggleDropdown()"
          class="text-white/80 hover:text-white hover:bg-white/20 transition-all duration-200 p-1.5 rounded-lg backdrop-blur-sm border border-white/20"
          aria-label="Close"
        >
          <span class="material-symbols-outlined text-base">close</span>
        </button>
      </div>
    </div>

    <!-- ===== CONTENT AREA (compact) ===== -->
    <div class="p-4 space-y-3">
      <!-- Clock In Time Card (compact) -->
      <div
        class="bg-[var(--color-bg)] p-3 rounded-xl border border-[var(--color-border)] shadow-[var(--shadow-sm)] backdrop-blur-sm"
      >
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2.5">
            <div
              class="p-2 bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-primary-dark)] rounded-lg shadow-sm"
            >
              <span class="material-symbols-outlined text-white text-base"
                >login</span
              >
            </div>
            <div>
              <p
                class="text-2xs font-semibold text-[var(--color-muted)] uppercase tracking-wider"
              >
                Clock In
              </p>
              <p
                class="text-xs font-bold text-[var(--color-font)] mt-0.5"
                *ngIf="activeSession"
              >
                {{
                  formatTimestamp(
                    activeSession.clockIn,
                    activeSession.locale,
                    activeSession.timezone
                  )
                }}
              </p>
              <p
                class="text-xs font-bold text-[var(--color-muted)] mt-0.5"
                *ngIf="!activeSession"
              >
                Not clocked in
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Grid (compact) -->
      <div class="grid grid-cols-2 gap-3">
        <!-- Active Time Card -->
        <div
          class="bg-[var(--color-success)]/10 p-3 rounded-xl border-2 border-[var(--color-success)]/20 shadow-[var(--shadow-sm)] relative overflow-hidden group hover:shadow-[var(--shadow-md)] transition-all duration-300 hover:scale-[1.02] backdrop-blur-sm"
        >
          <div
            class="absolute top-0 right-0 w-16 h-16 bg-[var(--color-success)]/20 rounded-full -mr-8 -mt-8"
          ></div>
          <div
            class="absolute bottom-0 left-0 w-12 h-12 bg-[var(--color-success)]/20 rounded-full -ml-6 -mb-6"
          ></div>
          <!-- Shimmer -->
          <div
            class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"
          ></div>

          <div class="relative">
            <div class="flex items-center gap-1.5 mb-2">
              <div class="p-1 bg-[var(--color-success)] rounded-md shadow-sm">
                <span class="material-symbols-outlined text-white text-xs"
                  >check_circle</span
                >
              </div>
              <div
                class="text-2xs font-bold text-[var(--color-success)] uppercase tracking-wider"
              >
                Active
              </div>
            </div>
            <div
              class="font-mono font-black text-2xl text-[var(--color-font)] tracking-tight drop-shadow-sm"
            >
              {{ elapsedTime }}
            </div>
            <div class="mt-1.5 flex items-center gap-1">
              <div
                class="w-1.5 h-1.5 rounded-full bg-[var(--color-success)] animate-pulse shadow-sm"
              ></div>
              <span class="text-2xs font-semibold text-[var(--color-success)]"
                >Recording</span
              >
            </div>
          </div>
        </div>

        <!-- Right column – only for USER role -->
        <div *ngIf="isUserRole">
          <!-- Logout Pending Card -->
          <div
            *ngIf="logoutPendingEvent"
            class="bg-[var(--color-danger)]/10 p-3 rounded-xl border-2 border-[var(--color-danger)]/20 shadow-[var(--shadow-sm)] relative overflow-hidden animate-pulse backdrop-blur-sm"
          >
            <div
              class="absolute top-0 right-0 w-16 h-16 bg-[var(--color-danger)]/20 rounded-full -mr-8 -mt-8"
            ></div>
            <div
              class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"
            ></div>

            <div class="relative">
              <div class="flex items-center gap-1.5 mb-2">
                <div
                  class="p-1 bg-[var(--color-danger)] rounded-md animate-bounce shadow-sm"
                >
                  <span class="material-symbols-outlined text-white text-xs"
                    >warning</span
                  >
                </div>
                <div
                  class="text-2xs font-bold text-[var(--color-danger)] uppercase tracking-wider"
                >
                  Pending
                </div>
              </div>
              <div
                class="font-mono font-black text-2xl text-[var(--color-danger)] tracking-tight drop-shadow-sm"
              >
                {{ pendingRemaining }}
              </div>
              <div class="mt-2 space-y-1 text-2xs text-[var(--color-muted)]">
                <div class="flex items-center gap-1">
                  <div
                    class="w-1 h-1 rounded-full bg-[var(--color-muted)]"
                  ></div>
                  <span class="font-medium"
                    >Start:
                    {{ logoutPendingEvent.createdAt | date: "HH:mm:ss" }}</span
                  >
                </div>
                <div
                  *ngIf="logoutPendingEvent.updatedAt"
                  class="flex items-center gap-1"
                >
                  <div
                    class="w-1 h-1 rounded-full bg-[var(--color-muted)]"
                  ></div>
                  <span class="font-medium"
                    >Target:
                    {{ logoutPendingEvent.updatedAt | date: "HH:mm:ss" }}</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- No Pending Card (compact) -->
          <div
            *ngIf="!logoutPendingEvent"
            class="bg-[var(--color-bg)] p-3 rounded-xl border-2 border-dashed border-[var(--color-border)] shadow-[var(--shadow-sm)] flex items-center justify-center backdrop-blur-sm group hover:shadow-[var(--shadow-md)] transition-all duration-300 h-full"
          >
            <div class="text-center">
              <div
                class="mx-auto w-8 h-8 bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-primary-dark)] rounded-full flex items-center justify-center mb-1 shadow-sm"
              >
                <span class="material-symbols-outlined text-white text-sm"
                  >schedule</span
                >
              </div>
              <p class="text-2xs font-semibold text-[var(--color-muted)]">
                No pending
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Button (compact) -->
      <div class="pt-3 border-t border-[var(--color-border)]">
        <button
          (click)="clockOutAndStartPending()"
          [disabled]="!!logoutPendingEvent && isUserRole"
          [attr.aria-disabled]="!!logoutPendingEvent && isUserRole"
          class="w-full px-4 py-2.5 rounded-xl shadow-[var(--shadow-sm)] transition-all duration-300 font-bold flex items-center justify-center gap-2 text-xs group relative overflow-hidden backdrop-blur-sm border"
          [ngClass]="
            logoutPendingEvent && isUserRole
              ? 'bg-[var(--color-bg)] text-[var(--color-muted)] cursor-not-allowed border-[var(--color-border)]'
              : 'bg-gradient-to-r from-[var(--color-danger)] to-[var(--color-danger)]/80 text-white hover:shadow-[var(--shadow-md)] hover:scale-[1.02] active:scale-[0.98] border-[var(--color-danger)]/30'
          "
          title="{{
            logoutPendingEvent && isUserRole
              ? 'Logout pending — button disabled'
              : 'Logout'
          }}"
        >
          <div
            *ngIf="!logoutPendingEvent || !isUserRole"
            class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"
          ></div>

          <span class="material-symbols-outlined text-base relative"
            >logout</span
          >
          <span class="relative">{{
            logoutPendingEvent && isUserRole
              ? "Logout in Progress..."
              : "Clock Out & Logout"
          }}</span>
        </button>
      </div>
    </div>

    <!-- ===== NO ACTIVE SESSION STATE (compact) ===== -->
    <div *ngIf="!activeSession && !logoutPendingEvent" class="p-6 text-center">
      <div
        class="mx-auto w-14 h-14 bg-gradient-to-br from-[var(--color-primary)]/20 to-[var(--color-primary-light)]/20 rounded-full flex items-center justify-center mb-2 shadow-[var(--shadow-sm)]"
      >
        <span
          class="material-symbols-outlined text-3xl text-[var(--color-primary)]"
          >schedule</span
        >
      </div>
      <p class="text-sm font-semibold text-[var(--color-font)] mb-1">
        No Active Session
      </p>
      <p class="text-2xs text-[var(--color-muted)] mb-2">
        Auto‑starts on LOGIN
      </p>
      <div
        class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-[var(--color-bg)] border border-[var(--color-border)] rounded-lg text-2xs text-[var(--color-muted)] font-medium backdrop-blur-sm"
      >
        <span class="material-symbols-outlined text-sm">info</span>
        Backend tracked
      </div>
    </div>

    <!-- ===== WARNING BOX (only USER role, compact) ===== -->
    <div *ngIf="isUserRole && !!logoutPendingEvent" class="px-4 pb-4">
      <div
        class="bg-[var(--color-danger)]/10 border-l-4 border-[var(--color-danger)] p-3 rounded-r-lg backdrop-blur-sm"
      >
        <div class="flex items-start gap-2">
          <span
            class="material-symbols-outlined text-[var(--color-danger)] text-base mt-0.5"
            >warning</span
          >
          <div>
            <p class="text-xs font-bold text-[var(--color-danger)] mb-0.5">
              Action Required
            </p>
            <p class="text-2xs text-[var(--color-danger)]/90">
              Clear pending approvals before logout
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
