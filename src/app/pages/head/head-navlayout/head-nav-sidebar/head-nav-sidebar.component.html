<!-- sidebar.component.html (updated: curved join + gradient header + slightly smaller header) -->
<div class=" flex bg-[var(--color-bg)]">
  <!-- Left Navigation Panel -->
  <div class="nav-panel flex">
    <!-- Primary Sidebar -->
    <div
      class="primary-sidebar fixed left-0 top-0 h-screen w-20 z-50 flex flex-col shadow-sm bg-gradient-to-r from-[var(--color-hover)] to-white overflow-hidden"
    >
      <!-- Logo/Brand Area -->
      <div
        class="brand-section px-4 py-3 border-b border-[var(--color-border)]"
      >
        <div class="logo-container flex flex-col items-center">
          <div
            class="w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-primary-light)] flex items-center justify-center shadow-md mb-3 group hover:scale-105 transition-transform duration-200"
          >
            <svg
              class="w-5 h-5 text-white"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="1.5"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
              />
            </svg>
          </div>
          <!-- <span class="text-[10px] font-semibold text-[var(--color-muted)] uppercase tracking-wider">BRANCH</span> -->
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="nav-menu flex-1 py-5 px-2 overflow-y-auto overflow-x-hidden">
        <ul class="space-y-1.5">
          <li
            *ngFor="let item of menuItems"
            class="relative group"
            [title]="item.label"
            (mouseenter)="onMenuItemEnter(item)"
            (mouseleave)="onMenuItemLeave()"
            (click)="openSubmenuExplicit(item)"
          >
            <button
              class="w-12 h-12 rounded-xl flex items-center justify-center relative transition-all duration-200 mx-auto group"
              [class]="
                isParentActive(item)
                  ? 'bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-primary-light)] text-white shadow-md'
                  : 'bg-white text-[var(--color-muted)] hover:bg-[var(--color-hover)] hover:text-[var(--color-primary)] border border-[var(--color-border)]'
              "
            >
              <div class="relative">
                <!-- replace this SVG block inside the menu button -->
                <!-- menu button icon (replace the SVG block inside the menu button) -->
                <span
                  class="material-symbols-outlined text-[18px] leading-none"
                  [class]="
                    isParentActive(item)
                      ? 'text-white'
                      : 'text-[var(--color-muted)] hover:text-[var(--color-primary)]'
                  "
                  aria-hidden="true"
                >
                  {{ getMenuIcon(item.icon) }}
                </span>
              </div>
            </button>

            <!-- Quick tooltip -->
            <div
              class="absolute left-full top-1/2 transform -translate-y-1/2 ml-3 px-3 py-2 bg-gray-900 text-white text-xs font-medium rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50 pointer-events-none shadow-xl"
            >
              {{ item.label }}
            </div>
          </li>
        </ul>
      </nav>

      <!-- User & Settings -->
       <div class="user-section p-3 border-t border-[var(--color-border)]">
        <div class="flex flex-col items-center space-y-3">
          <button
            class="relative group"
            (click)="toggleCurrentSubmenu()"
          >
            <div
              class="w-10 h-10 rounded-xl bg-[var(--color-primary)] flex items-center justify-center text-white shadow-sm hover:scale-105 transition-transform duration-200"
            >
              <span
                class="material-symbols-outlined text-[18px] leading-none flex items-center justify-center"
                aria-hidden="true"
              >
                 {{ explicitlyOpened ? 'close' : 'chevron_right' }}
              </span>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Secondary Panel -->
    <div
      #secondaryPanel
      class="secondary-panel fixed left-20 top-0 h-screen z-40 transition-all duration-300 ease-out"
      [class]="
        activeSubmenu ? 'w-80 opacity-100 visible' : 'w-0 opacity-0 invisible'
      "
      (mouseenter)="onPanelEnter()"
      (mouseleave)="onPanelLeave()"
    >
      <div
        *ngIf="activeSubmenu && submenuContent"
        class="panel-content h-full ml-2 rounded-r-2xl overflow-hidden bg-gradient-to-r from-[var(--color-hover)] to-white shadow-2xl border border-[var(--color-border)] backdrop-blur-sm bg-white/95"
      >
        <!-- Panel Header (icons use the same stroke-style) -->
        <div
          class="panel-header px-6 py-4 border-b border-[var(--color-border)] bg-gradient-to-r from-white to-[var(--color-hover)]/30"
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-accent)] flex items-center justify-center shadow-sm"
              >
               
                <span
                  class="material-symbols-outlined text-[18px] text-white"
                  aria-hidden="true"
                >
                  {{ getMenuIcon(submenuContent.icon || "dashboard") }}
                </span>
              </div>
              <div>
                <h2
                  class="text-lg font-semibold text-[var(--color-font)] font-display"
                >
                  {{ activeSubmenu }}
                </h2>
              </div>
            </div>

            <button
              (click)="closeSubmenu()"
              class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-[var(--color-hover)] transition-colors duration-200 text-[var(--color-muted)] hover:text-[var(--color-primary)]"
              title="Close panel"
            >
              <svg
                class="w-4 h-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
        </div>

        <!-- Panel Body (updated: show submenu children instead of recent-items) -->
        <div class="panel-body flex-1 overflow-y-auto py-6 px-5">
          <!-- If the active submenu has children, show them here -->
          <div *ngIf="submenuContent.children; else showRecentOrEmpty">
            <div class="space-y-3">
              <div
                *ngFor="let child of submenuContent.children"
                class="flex items-center p-3 rounded-lg hover:bg-[var(--color-hover)] transition-colors duration-200 cursor-pointer group"
                (click)="navigate(child.route)"
              >
                <span
                  class="material-symbols-outlined text-[var(--color-primary)] text-[18px] mx-2"
                >
                  {{ getChildIcon(child, activeSubmenu || "") }}
                </span>

                <div class="flex-1">
                  <div class="text-sm font-medium text-[var(--color-font)]">
                    {{ child.label }}
                  </div>
                </div>

                <svg
                  class="w-4 h-4 text-[var(--color-muted)] opacity-0 group-hover:opacity-100 transition-opacity duration-200 ml-2"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </div>

          <!-- Fallback: show recent items if submenu has no children, or a friendly empty state -->
          <ng-template #showRecentOrEmpty>
            <div *ngIf="getRecentItems().length > 0" class="recent-activity">
              <div class="space-y-3">
                <div
                  *ngFor="let recent of getRecentItems()"
                  class="flex items-center p-3 rounded-lg hover:bg-[var(--color-hover)] transition-colors duration-200 cursor-pointer group"
                  (click)="navigate(recent.route)"
                >
                  <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-[var(--color-primary)]/20 to-[var(--color-accent)]/20 flex items-center justify-center mr-3"
                  >
                    <svg
                      class="w-4 h-4 text-[var(--color-primary)]"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path d="M13 3v18h-2V3h2z" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-[var(--color-font)]">
                      {{ recent.label }}
                    </div>
                    <div class="text-xs text-[var(--color-muted)]">
                      Recently accessed
                    </div>
                  </div>
                  <svg
                    class="w-4 h-4 text-[var(--color-muted)] opacity-0 group-hover:opacity-100 transition-opacity duration-200"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </div>
            </div>

            <div
              *ngIf="getRecentItems().length === 0"
              class="text-sm text-[var(--color-muted)] p-4"
            >
              No items to display.
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Area with dynamic left margin -->
  

  <!-- Settings Modal -->
  <div *ngIf="settingPopup" class="settings-modal">
    <div
      class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden border border-[var(--color-border)]"
      >
        <div
          class="flex items-center justify-between px-6 py-5 border-b border-[var(--color-border)] bg-gradient-to-r from-white to-[var(--color-hover)]/30"
        >
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-accent)] flex items-center justify-center"
            >
              <svg
                class="w-5 h-5 text-white"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                />
              </svg>
            </div>
            <div>
              <h3
                class="text-lg font-semibold text-[var(--color-font)] font-display"
              >
                Profile Settings
              </h3>
              <p class="text-sm text-[var(--color-muted)]">
                Manage your account preferences
              </p>
            </div>
          </div>

          <button
            (click)="closeSettings()"
            class="w-10 h-10 rounded-lg flex items-center justify-center hover:bg-[var(--color-hover)] transition-colors duration-200 text-[var(--color-muted)] hover:text-[var(--color-primary)]"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
          <!-- <app-user-profile></app-user-profile> -->
        </div>

        <div
          class="px-6 py-4 border-t border-[var(--color-border)] bg-gray-50/50"
        >
          <div class="flex items-center justify-between">
            <div class="text-sm text-[var(--color-muted)]">
              <span class="text-[var(--color-primary)] font-medium"
                >Branch</span
              >
              Management System
            </div>
            <div class="flex items-center space-x-3">
              <button
                (click)="closeSettings()"
                class="px-4 py-2.5 text-sm font-medium text-[var(--color-muted)] hover:text-[var(--color-font)] transition-colors duration-200"
              >
                Cancel
              </button>
              <button
                (click)="saveSettings()"
                class="px-6 py-2.5 bg-gradient-to-r from-[var(--color-primary)] to-[var(--color-accent)] text-white font-medium rounded-xl hover:shadow-lg transition-all duration-200"
              >
                Save Changes
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
